name: New CI flow for Climb OBC Software
on:
  push:
    branches: [ develop ]
    paths-ignore:
      - '.github/**'
  release:
    types: [created]
  workflow_dispatch:

jobs:
  prepBuild:
    runs-on: ubuntu-latest
    name: Prepare Build Variables
    outputs:
      obcVersion: ${{ steps.create_ver.outputs.THE_SWVERSION }}
      obcVersion2: ${{ steps.create_ver.outputs.MY_SWVERSION }}
    steps:
      - id: create_ver
        name: Set Variables
        run: |
          THE_SWVERSION=$(printf 'Ver_%.8s' "${{ github.sha }}" )
          MY_SWVERSION=$(printf 'My_%.10s' "$GITHUB_REF_NAME" )
          #echo "THE_SWVERSION=$THE_SWVERSION" >> $GITHUB_ENV
          #echo "MY_SWVERSION=$MY_SWVERSION" >> $GITHUB_ENV
          echo "THE_SWVERSION=$THE_SWVERSION" >> "$GITHUB_OUTPUT"
          echo "MY_SWVERSION=$MY_SWVERSION" >> "$GITHUB_OUTPUT"
          echo "jobs output obcVersion set to '$THE_SWVERSION'"
          echo "jobs output obcVersion2 set to '$MY_SWVERSION''"
      
  buildIt:
    runs-on: ubuntu-latest
    needs: prepBuild
    name: Build the Software artefacts
    steps:
      - env:
          OBC_VERSION: ${{needs.prepBuild.outputs.obcVersion}}
          OBC_VERSION_2: ${{needs.prepBuild.outputs.obcVersion2}}
        name: simulate build  
        run: |
          echo "$OBC_VERSION"
          echo "$OBC_VERSION_2"    
          echo dummy build creating 2 matricx results ...
          echo "dummy content" >> ./ClimbObc${{ env.OBC_VERSION }}-Dev.axf
          echo "dummy content" >> ./ClimbObc${{ env.OBC_VERSION }}-Obc.axf
          pwd
          ls
          
